platform: linux

image_resource:
  type: docker-image
  source:
    repository: openjdk
    tag: '8-jdk'

inputs:
  - name: pal-tracker

run:
  path: bash
  args:
  - -exc
  - |
    cd pal-tracker
    curl -L "https://packages.cloudfoundry.org/stable?release=linux64-binary&source=github" | tar -zx
    chmod +x cf
    ./cf login -a $CF_API_URL -u $CF_USERNAME -p $CF_PASSWORD -o $CF_ORG -s $CF_SPACE
    ./cf run-task pal-tracker-migrations ".java-buildpack/open_jdk_jre/bin/java org.springframework.boot.loader.JarLauncher" --name run-migrations
    ./cf tasks pal-tracker-migrations

    # In production you would need a step to make sure the migration task completes successfully or we fail the build.

